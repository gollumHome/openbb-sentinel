name: ☀️ Run Pre-Market Strategy

on:
  # 1. 定时触发 (Cron)
  # GitHub 使用 UTC 时间。
  # 美股盘前大概是北京时间 20:00 (冬令时 21:00)
  # 北京时间 20:30 = UTC 12:30
  schedule:
    # 分 时 日 月 周 (这里设为周一到周五 UTC 12:30)
    - cron: '30 12 * * 1-5'

  # 2. 手动触发按钮 (方便测试)
  workflow_dispatch:

jobs:
  run-analysis:
    runs-on: ubuntu-latest # 使用 Ubuntu 系统 (美国IP)

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run Sentinel (Pre-Market)
      env:
        # 把 Secrets 注入环境变量
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        WECHAT_WEBHOOK_URL: ${{ secrets.WECHAT_WEBHOOK_URL }}
        FMP_KEY: ${{ secrets.FMP_KEY }}
        TIINGO_KEY: ${{ secrets.TIINGO_KEY }}
      run: |
        # 运行 main.py 并传入参数 pre
        python main.py pre